(function(h,y,s,a,g,f,m,M){"use strict";const{TextStyleSheet:_,Text:P}=s.findByProps("TextStyleSheet"),{View:T}=M.General;s.findByProps("BOT_AVATARS");const{createBotMessage:N}=s.findByProps("createBotMessage"),{receiveMessage:w}=s.findByProps("receiveMessage"),I=s.findByName("OAuth2AuthorizeModal");s.findByProps("PRIMARY_INFO_TOP_OFFSET","SECONDARY_INFO_TOP_MARGIN","SIDE_PADDING");const R=s.findByName("RowManager"),l=s.findByProps("Messages"),E=s.findByProps("sendMessage","receiveMessage"),u=s.findByStoreName("UserStore"),O=s.findByStoreName("SelectedChannelStore"),{pushModal:C,popModal:A}=s.findByProps("pushModal","popModal"),D=s.findByProps("show","confirm","close"),v="https://wedlock.exhq.dev",b=/https:\/\/wedlock\.exhq\.dev\/v2\/propose\/embed\?proposalid=([^\n&]+)/;async function d(i,r,e,o){let t;if(t=await fetch(v+"/"+r+(e?"?"+new URLSearchParams(e):""),{method:i,headers:i==="POST"?{authorization:await x()}:{}}),t.status===200)return await t.json();S(t.status.toString())}async function x(){return f.storage.token?f.storage.token:new Promise(function(i){C({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:I,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:"1166756085554757733",scopes:["identify"],responseType:"token",permissions:0n,cancelCompletesFlow:!1,callback:async function(r){let{location:e}=r;const o=e.split("#")[1],t=new URLSearchParams(o).get("access_token");f.storage.token=t,i(t)},dismissOAuthModal:function(){return A("oauth2-authorize")}},closable:!0}})})}function S(i){const r=O.getChannelId(),e=u.getUser("1155605314557718620");w(r,Object.assign(N({channelId:r,content:i}),{author:e}))}let p=[];var B={onLoad:function(){p.push(y.commands.registerCommand({name:"propose",displayName:"propose",description:"start the edating!",displayDescription:"start the edating!",options:[{name:"proposee",displayName:"proposee",description:l.Messages.COMMAND_SHRUG_MESSAGE_DESCRIPTION,displayDescription:l.Messages.COMMAND_SHRUG_MESSAGE_DESCRIPTION,required:!0,type:6},{name:"message",displayName:"message",description:l.Messages.COMMAND_SHRUG_MESSAGE_DESCRIPTION,displayDescription:l.Messages.COMMAND_SHRUG_MESSAGE_DESCRIPTION,required:!0,type:3}],applicationId:-1,inputType:1,type:1,execute:async function(e,o){if(e[0].value===u.getCurrentUser().id){await S("you cant marry yourself silly");return}await d("POST","v2/propose",{to:e[0].value,msg:e[1].value}).then(function(t){E.sendMessage(o.channel.id,{content:`will you marry me <@${e[0].value}>? ${v}/v2/propose/embed?proposalid=`+t.id})})}}));function i(e){console.log(e.id),console.log(`https://wedlock.exhq.dev/v2/marriage?userid=${e.id}`);const[o,t]=a.React.useState(null);return a.React.useEffect(function(){fetch(`https://wedlock.exhq.dev/v2/marriage?userid=${e.id}`).then(function(n){return n.json()}).then(function(n){if(n.reason=="Not Found")return t(a.React.createElement(a.React.Fragment,null)),a.React.createElement(a.React.Fragment,null);fetch(`https://adu.shiggy.fun/v1/${n.bottom?n.bottom:n.top}.json`).then(function(c){return c.json()}).then(function(c){t("married to "+c.username)})}).catch(function(n){console.error("Error fetching data:",n)})},[]),a.React.createElement(T,{style:{marginTop:10}},a.React.createElement(P,{style:[_["text-xs/medium"]]},o))}p.push(g.after("default",s.find(function(e){return e?.default?.name==="UserProfileName"}),function(e,o){let[t]=e,n=o?.props?.children?.props?.children;n&&(console.log(t.user.id),n.push(a.React.createElement(i,{id:t.user.id})))})),p.push(y.commands.registerCommand({name:"divorce",displayName:"divorce",description:"stop the edating!",displayDescription:"stop the edating!",applicationId:-1,inputType:1,type:1,execute(e,o){(async function(){await d("POST","v2/divorce")})()}}));const r=async function(e){if(e?.data?.customId==="customid:3_i_think_this_can_be_anything"){const o=s.findByStoreName("MessageStore").getMessage(s.findByStoreName("SelectedChannelStore").getChannelId(),e?.messageId).content.split(" ").find(function(t){return t.startsWith("https://wedlock.exhq.dev/v2/propose/embed?proposalid=")});if(o){const t=o.replace("https://wedlock.exhq.dev/v2/propose/embed?proposalid=","");await d("GET","v2/propose/view",{proposalid:t}).then(function(n){n.to===u.getCurrentUser().id&&D.show({title:u.getUser(n.from).username+"has proposed to you!",body:"cozy",confirmText:"accept",cancelText:"deny",onConfirm:async function(){d("POST","v2/propose/accept",{proposalid:t}).then(function(c){return c&&m.showToast("Accepted proposal succesfully")})},onCancel:async function(){d("POST","v2/propose/deny",{proposalid:t}).then(function(c){return c&&m.showToast("Declined proposal succesfully")})}})})}}};a.FluxDispatcher.subscribe("INTERACTION_QUEUE",r),p.push(g.after("generate",R.prototype,function(e,o){let[t]=e,{message:n}=o;!n||!b.exec(t.message.content)||(n.components=[],n.components=[{type:1,indices:[0],components:[{type:2,customId:"customid:3_i_think_this_can_be_anything",style:1,disabled:void 0,url:void 0,label:"view",emoji:{id:void 0,name:"\u{1F499}",animated:void 0,src:void 0},indices:[0,0],applicationId:"0",state:0}],errorText:void 0}])}))},onUnload:function(){for(const i of p)i()}};return h.default=B,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta.ui.components);
